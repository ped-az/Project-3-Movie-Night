<!DOCTYPE html>
<html>
  <head>
    <title>Movie Night Dashboard</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="fluid-container bg-light">
      <div class="mx-3">
        <h1>Project 3: Movie Night</h1>
        <p>Presented by: ..., ..., ...</p>
        <a href="/" class="btn btn-primary">Data</a>
        <a href="/dashboard" class="btn btn-danger">Dashboard</a>
        <hr />
        <h2 class="mb-3">Dashboard</h2>
        <div class="d-flex flex-column gap-5">
          <div class="row">
            <div class="col-3">
              <div
                class="d-flex flex-column justify-content-center align-items-center rounded rounded-3 p-3 text-bg-primary statistic"
              >
                <h4 class="text-center">Number of Movies</h4>
                <div class="text-center">From 1920 to 2020</div>
                <div class="fs-2 text-center">999</div>
              </div>
            </div>
            <div class="col-3">
              <div
                class="d-flex flex-column justify-content-center align-items-center rounded rounded-3 p-3 text-bg-primary statistic"
              >
                <h4 class="text-center">Total Gross</h4>

                <div class="text-center">Top 1: Star Wars: Episode VII</div>
                <div class="fs-2 text-center">$56,363,040,043</div>
              </div>
            </div>
            <div class="col-3">
              <div
                class="d-flex flex-column justify-content-center align-items-center rounded rounded-3 p-3 text-bg-primary statistic"
              >
                <h4 class="text-center">Top 1 Movie by Rating</h4>

                <div class="text-center">The Shawshank Redemption</div>
                <div class="fs-2 text-center">$28,341,469</div>
              </div>
            </div>
            <div class="col-3">
              <div
                class="d-flex flex-column justify-content-center align-items-center rounded rounded-3 p-3 text-bg-primary statistic"
              >
                <h4 class="text-center">Top 1 Genre</h4>
                <div class="text-center">Drama</div>
                <div class="fs-2 text-center">289</div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-8"><canvas id="bubble-chart"></canvas></div>
            <div class="col-4"><canvas id="top-genre"></canvas></div>
          </div>
          <div class="row">
            <div class="col-6"><canvas id="top-imdb"></canvas></div>
            <div class="col-6"><canvas id="top-gross"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const tableHeaders = [
        "Series_Title",
        "Released_Year",
        "Certificate",
        "Director",
        "Genre_1",
        "Runtime",
        "Meta_score",
        "IMDB_Rating",
        "No_of_Votes",
        "Gross",
      ];
      const sortFields = [
        "IMDB_Rating",
        "Runtime",
        "Meta_score",
        "No_of_Votes",
        "Gross",
        "Released_Year",
      ];

      async function getAllMovieData() {
        const url = `/api/movies/`;
        console.log(url);
        const response = await fetch(url);
        const data = await response.json();
        console.log(data);
        return data;
      }

      async function getTop10lMovieData(attribute) {
        const url = `/api/top_movies/${attribute}`;
        console.log(url);
        const response = await fetch(url);
        const data = await response.json();
        console.log(data);
        return data;
      }

      async function getGenreData() {
        const url = `/api/genre/`;
        console.log(url);
        const response = await fetch(url);
        const data = await response.json();
        console.log("genreData", data);
        return data;
      }

      (async function () {
        const genreData = await getGenreData();
        new Chart(document.getElementById("top-genre"), {
          type: "doughnut",
          data: {
            labels: genreData.map((x) => x.Genre_1),
            datasets: [
              {
                label: "Percentage",
                data: genreData.map((x) => (x.count / 999) * 100),
                // backgroundColor: "#ffbf00",
              },
            ],
          },
        });
        const top10IMDBData = await getTop10lMovieData("IMDB_Rating");
        new Chart(document.getElementById("top-imdb"), {
          type: "bar",
          data: {
            labels: top10IMDBData.map((x) => x.Series_Title),
            datasets: [
              {
                label: "Top 10 Movies by IMDB Rating",
                data: top10IMDBData.map((x) => x.IMDB_Rating),
                backgroundColor: "#3cb043",
              },
            ],
          },
        });

        const top10GrossData = await getTop10lMovieData("Gross");
        new Chart(document.getElementById("top-gross"), {
          type: "bar",
          data: {
            labels: top10GrossData.map((x) => x.Series_Title),
            datasets: [
              {
                label: "Top 10 Movies by Gross",
                data: top10GrossData.map((x) => x.Gross),
                backgroundColor: "#ff6384",
              },
            ],
          },
        });

        const allMovieData = await getAllMovieData();
        new Chart(document.getElementById("bubble-chart"), {
          type: "bubble",
          data: {
            labels: allMovieData.map(
              (x) =>
                `${x.Series_Title}: ${new Intl.NumberFormat("en-AU", {
                  style: "currency",
                  currency: "AUD",
                }).format(x.Gross)}`
            ),
            datasets: [
              {
                label: "Gross",
                data: allMovieData.map((row) => ({
                  x: row.Released_Year,
                  y: row.IMDB_Rating,
                  r: row.Gross / 25000000,
                })),
                hoverBackgroundColor: "red",
              },
            ],
          },
        });
      })();
    </script>
  </body>
</html>
